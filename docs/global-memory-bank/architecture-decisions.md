# アーキテクチャ決定記録

tags: #architecture #decision #json #version-2

## 概要

このドキュメントは、Memory Bank MCP Serverのアーキテクチャに関する重要な決定事項を記録します。
各決定は検討した背景、選択した理由、および影響を含めて記載されています。

## バージョン2.0への移行計画 (2025-03-16)

### コンテキスト

現在のMemory Bankはドキュメント保存形式としてMarkdownとJSONの両方をサポートしています。
これにより以下の問題が発生しています：

1. 双方向変換ロジックの複雑さ（Markdown⇔JSON）
2. 変換時の情報欠落リスク
3. テストコードの肥大化
4. マイナーアップデートの度に両方のフォーマットテストが必要
5. スキーマの厳密な検証が難しい
6. データベースへの将来的な移行が複雑になる

### 決定

**Memory Bank 2.0では、JSONを唯一のデータ保存形式とし、Markdownサポートを完全に廃止する。**

この決定により：
- データモデルをスキーマファーストで定義
- 型安全性の向上
- 検証プロセスの簡素化
- コードベースの軽量化
- 将来の拡張性向上

### 影響

#### ポジティブな影響

- コードベースがシンプルになり、理解と保守が容易になる
- 構造化データとしてクエリやフィルタリングが容易
- スキーマによる厳密な型チェックが可能
- テストが単純化され、カバレッジが向上
- 将来的なデータベース（SurrealDB等）への移行パスが明確

#### ネガティブな影響

- Markdownの人間可読性が失われる
- 既存のMarkdownファイルを移行する必要がある
- エディタ、ビューワー等のツールが必要になる
- バージョン1.xと互換性がなくなる

#### 軽減策

- JSON→Markdown変換機能を別のレイヤー（表示レイヤー）として実装可能
- マイグレーションスクリプトによる既存ファイルの自動変換
- CLIツールの拡張でJSONの読み書きを支援
- 明確な移行ガイドの提供

## 実装計画

### フェーズ1: 準備

1. JSONスキーマの完全な確定
2. 現在の変換ロジックの解析と必要な情報の特定
3. マイグレーションスクリプトの設計と開発

### フェーズ2: コードリファクタリング

1. Markdownパーサー・コンバーターの削除
2. リポジトリの実装をJSON専用に書き換え
3. CLIコマンドのJSON専用対応
4. 型定義とバリデーションの強化

### フェーズ3: マイグレーションと検証

1. マイグレーションスクリプトのテスト
2. 既存メモリバンクのバックアップ
3. マイグレーションの実行
4. 変換結果の検証

### フェーズ4: リリース

1. バージョン2.0.0としてリリース
2. ドキュメント更新
3. 移行ガイドの提供
4. フィードバックの収集

## タイムライン

- 設計フェーズ: 1週間
- 開発フェーズ: 2週間
- テストフェーズ: 1週間
- リリース準備: 1週間

## 検討した代替案

### 代替案1: 現状維持（両方のフォーマットをサポート）

**利点**:
- 互換性の維持
- 人間可読性と構造化データの両立

**欠点**:
- 変換ロジックの複雑性が続く
- 今後も二重メンテナンスが必要
- テストの複雑さが継続

### 代替案2: JSONをプライマリとしつつMarkdownも残す（一方向変換）

**利点**:
- 一部互換性を維持
- 人間可読性を犠牲にしない

**欠点**:
- 依然として変換ロジックが必要
- 同期の問題が残る
- 完全な構造化の恩恵を受けられない

## 決定理由

- 技術的負債を根本的に解消するため
- 将来のデータベース移行を見据えて
- スキーマファーストの開発パラダイムへの移行
- メンテナンスコストの削減

## 責任者

- 設計: t3ta
- 実装: memory-bank-team
- レビュー: memory-bank-team

## ステータス

- [x] 提案
- [ ] 承認
- [ ] 実装中
- [ ] 完了
- [ ] 廃止

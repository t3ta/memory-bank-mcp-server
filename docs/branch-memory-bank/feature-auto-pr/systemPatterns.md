# システムパターン

## 技術的決定事項

### PRタイトルと概要の生成方法

#### コンテキスト
ブランチメモリバンクには開発目的やタスク詳細が記録されており、それらをPR作成時に活用したい

#### 決定事項
ブランチのメモリバンクから情報を抽出し、PRタイトルと概要を自動生成する機能を実装する

#### 影響
- PRの作成プロセスが効率化される
- PRの品質と一貫性が向上する

### クリーンアーキテクチャの適用

#### コンテキスト
PRの自動生成機能を構造化された方法で実装し、将来の拡張性を高める必要がある

#### 決定事項
クリーンアーキテクチャのパターンに従い、レイヤー分けされた設計を採用（インターフェース層、アプリケーション層、ドメイン層）

#### 影響
- コードの責任分離が明確になる
- ユニットテストが容易になる
- 将来の機能拡張や変更が容易になる
- 初期実装コストが高くなる

### セクション抽出ロジックの改善

#### コンテキスト
以前のセクション抽出アルゴリズムは不完全で、セクションが正確に抽出されなかった

#### 決定事項
より堅牢なセクション抽出ロジックを実装し、空行の処理や境界条件の処理を改善

#### 影響
- PRの内容が質的に向上
- ユーザーがメモリバンクの内容を正確に反映できる
- エッジケースにも対応可能

### テンプレート処理の強化

#### コンテキスト
以前の実装ではプレースホルダー置換が不完全で、空セクションや重複フッターの問題があった

#### 決定事項
プレースホルダー置換とクリーンアップのロジックを強化し、空セクションを適切に処理する機能を追加

#### 影響
- 生成されるPRの体裁が改善
- 余分なマークダウンやコメントの問題が解消
- 最終的なPRドキュメントが読みやすくなる

### systemPatternsのメモリリーク対策

#### コンテキスト
systemPatterns.mdの内容が巨大になるとメモリリークが発生する問題があり、アプリケーションが強制終了することがあった

#### 決定事項
1. systemPatterns.mdをチャンク単位で読み込んで処理する実装を追加
2. 必要な技術的決定のみを抽出する効率的な方法を実装
3. ファイル全体を読み込まずに最近の決定事項だけを処理できるよう最適化

#### 影響
- メモリ使用量を大幅に削減し、大きなsystemPatterns.mdファイルでもクラッシュせずに動作可能
- 処理速度の向上
- PR生成機能を安定して使用可能
- 過去の決定事項がすべて含まれないため、情報量がやや減少する
- 直近の重要な決定事項に焦点を当てたPR内容となる

### テンプレート処理の強化

#### コンテキスト
以前の実装ではプレースホルダー置換が不完全で、空セクションや重複フッターの問題があった

#### 決定事項
プレースホルダー置換とクリーンアップのロジックを強化し、空セクションを適切に処理する機能を追加

#### 影響
- 生成されるPRの体裁が改善
- 余分なマークダウンやコメントの問題が解消
- 最終的なPRドキュメントが読みやすくなる

### セクション抽出ロジックの改善

#### コンテキスト
以前のセクション抽出アルゴリズムは不完全で、セクションが正確に抽出されなかった

#### 決定事項
より堅牢なセクション抽出ロジックを実装し、空行の処理や境界条件の処理を改善

#### 影響
- PRの内容が質的に向上
- ユーザーがメモリバンクの内容を正確に反映できる
- エッジケースにも対応可能

### クリーンアーキテクチャの適用

#### コンテキスト
PRの自動生成機能を構造化された方法で実装し、将来の拡張性を高める必要がある

#### 決定事項
クリーンアーキテクチャのパターンに従い、レイヤー分けされた設計を採用（インターフェース層、アプリケーション層、ドメイン層）

#### 影響
- コードの責任分離が明確になる
- ユニットテストが容易になる
- 将来の機能拡張や変更が容易になる
- 初期実装コストが高くなる

### PRタイトルと概要の生成方法

#### コンテキスト
ブランチメモリバンクには開発目的やタスク詳細が記録されており、それらをPR作成時に活用したい

#### 決定事項
ブランチのメモリバンクから情報を抽出し、PRタイトルと概要を自動生成する機能を実装する

#### 影響
- PRの作成プロセスが効率化される
- PRの品質と一貫性が向上する

### PR生成プロセスのワークフロー

#### コンテキスト
PR情報の生成と実際のPR作成を効率的に連携させる必要がある

#### 決定事項
`create_pull_request` MCPツールを使用してpullRequest.mdファイルを生成
GitHub ActionsワークフローがpullRequest.mdファイルの存在を検知して自動的にPRを作成
PR作成後、トリガーファイル（pullRequest.md）を自動的に削除して再トリガーを防止

#### 影響
- 宣言的なアプローチによりプロセスが明確に分離される
- 手動でのPR作成作業が不要になり効率化される
- 一貫性のあるPR内容が保証される

### ブランチメモリバンクからの情報抽出

#### コンテキスト
メモリバンクから関連情報を効果的に抽出し、適切なPRコンテンツを生成する必要がある

#### 決定事項
各メモリバンクファイル（activeContext.md, progress.md, systemPatterns.md等）から適切なセクションを抽出
多言語対応（日本語・英語）のテンプレートを用意
メタデータ（タイトル、ターゲットブランチ、レビュワー、ラベル）のカスタマイズをサポート

#### 影響
- 柔軟なPR生成プロセスが実現される
- 開発者は最小限の労力でカスタマイズが可能になる
- 情報抽出の精度によりPR品質が大きく左右される

### MemoryDocumentの扱い改善

#### コンテキスト
saveDocumentメソッドの引数が変更されており、古い形式での呼び出しが型エラーを引き起こしていた

#### 決定事項
MemoryDocument.create()を使って適切なドメインオブジェクトを生成し、保存する

#### 影響
- 型エラーの解消
- ドメインモデルの一貫性担保
- より明示的なAPIの使用
- ドメインロジックの集約

### DIコンテナの型安全性向上

#### コンテキスト
DIコンテナのget()メソッドが型情報を適切に保持できず、unknownとして返される問題があった

#### 決定事項
型アサーション(as キーワード)を使用して、DIコンテナから取得した値に明示的に型を付与する

#### 影響
- コンパイルエラーを解決
- 型安全性が向上
- コード冗長性が少し増加
- 将来的にはDIコンテナのインターフェース改善が必要

### MCPResponseの型安全性向上

#### コンテキスト
MCPResponseの型がユニオン型（MCPSuccessResponse | MCPErrorResponse）で、直接data/errorへアクセスするとエラーになる

#### 決定事項
successフラグによる型ガードを追加し、適切に型を分岐させる実装に修正

#### 影響
- 型エラーを解消
- コードの堅牢性向上
- 型安全なコードが保証される
- 将来的なリファクタリングが容易になる

### CLIコマンドの追加

#### コンテキスト
create-pull-requestコマンドがCLIに実装されておらず、ユーザーがCLIから直接PR生成機能を使用できない

#### 決定事項
CLIにcreate-pull-requestコマンドを追加し、ブランチ名、タイトル、ベースブランチ、言語をオプションとして受け取れるようにする

#### 影響
- CLIからPR生成機能を利用できるようになる
- シェルスクリプトやCI/CDパイプラインから自動PR生成を実行できる
- ユーザー体験が向上する
- テスト容易性が向上する

### DIコンテナの型安全性向上

#### コンテキスト
DIコンテナのget()メソッドが型情報を適切に保持できず、unknownとして返される問題があった

#### 決定事項
型アサーション(as キーワード)を使用して、DIコンテナから取得した値に明示的に型を付与する

#### 影響
- コンパイルエラーを解決
- 型安全性が向上
- コード冗長性が少し増加
- 将来的にはDIコンテナのインターフェース改善が必要

### PR生成プロセスのワークフロー

#### コンテキスト
PR情報の生成と実際のPR作成を効率的に連携させる必要がある

#### 決定事項
`create_pull_request` MCPツールを使用してpullRequest.mdファイルを生成
GitHub ActionsワークフローがpullRequest.mdファイルの存在を検知して自動的にPRを作成
PR作成後、トリガーファイル（pullRequest.md）を自動的に削除して再トリガーを防止

#### 影響
- 宣言的なアプローチによりプロセスが明確に分離される
- 手動でのPR作成作業が不要になり効率化される
- 一貫性のあるPR内容が保証される

### ブランチメモリバンクからの情報抽出

#### コンテキスト
メモリバンクから関連情報を効果的に抽出し、適切なPRコンテンツを生成する必要がある

#### 決定事項
各メモリバンクファイル（activeContext.md, progress.md, systemPatterns.md等）から適切なセクションを抽出
多言語対応（日本語・英語）のテンプレートを用意
メタデータ（タイトル、ターゲットブランチ、レビュワー、ラベル）のカスタマイズをサポート

#### 影響
- 柔軟なPR生成プロセスが実現される
- 開発者は最小限の労力でカスタマイズが可能になる
- 情報抽出の精度によりPR品質が大きく左右される

### 型安全性のためのチェック改善

#### コンテキスト
MCPResponseの型がユニオン型（MCPSuccessResponse | MCPErrorResponse）で、直接data/errorへアクセスするとエラーになる

#### 決定事項
successフラグによる型ガードを追加し、適切に型を分岐させる実装に修正

#### 影響
- 型エラーを解消
- コードの堅牢性向上
- 型安全なコードが保証される
- 将来的なリファクタリングが容易になる

### MemoryDocumentの扱い改善

#### コンテキスト
saveDocumentメソッドの引数が変更されており、古い形式での呼び出しが型エラーを引き起こしていた

#### 決定事項
MemoryDocument.create()を使って適切なドメインオブジェクトを生成し、保存する

#### 影響
- 型エラーの解消
- ドメインモデルの一貫性担保
- より明示的なAPIの使用
- ドメインロジックの集約

### MemoryDocumentの扱い改善

#### コンテキスト
saveDocumentメソッドの引数が変更されており、古い形式での呼び出しが型エラーを引き起こしていた

#### 決定事項
MemoryDocument.create()を使って適切なドメインオブジェクトを生成し、保存する

#### 影響
- 型エラーの解消
- ドメインモデルの一貫性担保
- より明示的なAPIの使用
- ドメインロジックの集約

### 型安全性のためのチェック改善

#### コンテキスト
MCPResponseの型がユニオン型（MCPSuccessResponse | MCPErrorResponse）で、直接data/errorへアクセスするとエラーになる

#### 決定事項
successフラグによる型ガードを追加し、適切に型を分岐させる実装に修正

#### 影響
- 型エラーを解消
- コードの堅牢性向上
- 型安全なコードが保証される
- 将来的なリファクタリングが容易になる

### ブランチメモリバンクからの情報抽出

#### コンテキスト
メモリバンクから関連情報を効果的に抽出し、適切なPRコンテンツを生成する必要がある

#### 決定事項
- 各メモリバンクファイル（activeContext.md, progress.md, systemPatterns.md等）から適切なセクションを抽出
- 多言語対応（日本語・英語）のテンプレートを用意
- メタデータ（タイトル、ターゲットブランチ、レビュワー、ラベル）のカスタマイズをサポート

#### 影響
- 柔軟なPR生成プロセスが実現される
- 開発者は最小限の労力でカスタマイズが可能になる
- 情報抽出の精度によりPR品質が大きく左右される

### PR生成プロセスのワークフロー

#### コンテキスト
PR情報の生成と実際のPR作成を効率的に連携させる必要がある

#### 決定事項
- `create_pull_request` MCPツールを使用してpullRequest.mdファイルを生成
- GitHub ActionsワークフローがpullRequest.mdファイルの存在を検知して自動的にPRを作成
- PR作成後、トリガーファイル（pullRequest.md）を自動的に削除して再トリガーを防止

#### 影響
- 宣言的なアプローチによりプロセスが明確に分離される
- 手動でのPR作成作業が不要になり効率化される
- 一貫性のあるPR内容が保証される

### PRタイトルと概要の生成方法

#### コンテキスト
ブランチメモリバンクには開発目的やタスク詳細が記録されており、それらをPR作成時に活用したい

#### 決定事項
ブランチのメモリバンクから情報を抽出し、PRタイトルと概要を自動生成する機能を実装する

#### 影響
- PRの作成プロセスが効率化される
- PRの品質と一貫性が向上する

### クリーンアーキテクチャの適用

#### コンテキスト
PRの自動生成機能を構造化された方法で実装し、将来の拡張性を高める必要がある

#### 決定事項
クリーンアーキテクチャのパターンに従い、レイヤー分けされた設計を採用（インターフェース層、アプリケーション層、ドメイン層）

#### 影響
- コードの責任分離が明確になる
- ユニットテストが容易になる
- 将来の機能拡張や変更が容易になる
- 初期実装コストが高くなる

### セクション抽出ロジックの改善

#### コンテキスト
以前のセクション抽出アルゴリズムは不完全で、セクションが正確に抽出されなかった

#### 決定事項
より堅牢なセクション抽出ロジックを実装し、空行の処理や境界条件の処理を改善

#### 影響
- PRの内容が質的に向上
- ユーザーがメモリバンクの内容を正確に反映できる
- エッジケースにも対応可能

### テンプレート処理の強化

#### コンテキスト
以前の実装ではプレースホルダー置換が不完全で、空セクションや重複フッターの問題があった

#### 決定事項
プレースホルダー置換とクリーンアップのロジックを強化し、空セクションを適切に処理する機能を追加

#### 影響
- 生成されるPRの体裁が改善
- 余分なマークダウンやコメントの問題が解消
- 最終的なPRドキュメントが読みやすくなる

### DIコンテナの型安全性向上

#### コンテキスト
DIコンテナのget()メソッドが型情報を適切に保持できず、unknownとして返される問題があった

#### 決定事項
型アサーション(as キーワード)を使用して、DIコンテナから取得した値に明示的に型を付与する

#### 影響
- コンパイルエラーを解決
- 型安全性が向上
- コード冗長性が少し増加
- 将来的にはDIコンテナのインターフェース改善が必要

### ブランチメモリバンクからの情報抽出

#### コンテキスト
メモリバンクから関連情報を効果的に抽出し、適切なPRコンテンツを生成する必要がある

#### 決定事項
- 各メモリバンクファイル（activeContext.md, progress.md, systemPatterns.md等）から適切なセクションを抽出
- 多言語対応（日本語・英語）のテンプレートを用意
- メタデータ（タイトル、ターゲットブランチ、レビュワー、ラベル）のカスタマイズをサポート

#### 影響
- 柔軟なPR生成プロセスが実現される
- 開発者は最小限の労力でカスタマイズが可能になる
- 情報抽出の精度によりPR品質が大きく左右される

### PR生成プロセスのワークフロー

#### コンテキスト
PR情報の生成と実際のPR作成を効率的に連携させる必要がある

#### 決定事項
- `create_pull_request` MCPツールを使用してpullRequest.mdファイルを生成
- GitHub ActionsワークフローがpullRequest.mdファイルの存在を検知して自動的にPRを作成
- PR作成後、トリガーファイル（pullRequest.md）を自動的に削除して再トリガーを防止

#### 影響
- 宣言的なアプローチによりプロセスが明確に分離される
- 手動でのPR作成作業が不要になり効率化される
- 一貫性のあるPR内容が保証される

### PRタイトルと概要の生成方法

#### コンテキスト
ブランチメモリバンクには開発目的やタスク詳細が記録されており、それらをPR作成時に活用したい

#### 決定事項
ブランチのメモリバンクから情報を抽出し、PRタイトルと概要を自動生成する機能を実装する

#### 影響
- PRの作成プロセスが効率化される
- PRの品質と一貫性が向上する

### クリーンアーキテクチャの適用

#### コンテキスト
PRの自動生成機能を構造化された方法で実装し、将来の拡張性を高める必要がある

#### 決定事項
クリーンアーキテクチャのパターンに従い、レイヤー分けされた設計を採用（インターフェース層、アプリケーション層、ドメイン層）

#### 影響
- コードの責任分離が明確になる
- ユニットテストが容易になる
- 将来の機能拡張や変更が容易になる
- 初期実装コストが高くなる

### セクション抽出ロジックの改善

#### コンテキスト
以前のセクション抽出アルゴリズムは不完全で、セクションが正確に抽出されなかった

#### 決定事項
より堅牢なセクション抽出ロジックを実装し、空行の処理や境界条件の処理を改善

#### 影響
- PRの内容が質的に向上
- ユーザーがメモリバンクの内容を正確に反映できる
- エッジケースにも対応可能

### テンプレート処理の強化

#### コンテキスト
以前の実装ではプレースホルダー置換が不完全で、空セクションや重複フッターの問題があった

#### 決定事項
プレースホルダー置換とクリーンアップのロジックを強化し、空セクションを適切に処理する機能を追加

#### 影響
- 生成されるPRの体裁が改善
- 余分なマークダウンやコメントの問題が解消
- 最終的なPRドキュメントが読みやすくなる

### DIコンテナの型安全性向上

#### コンテキスト
DIコンテナのget()メソッドが型情報を適切に保持できず、unknownとして返される問題があった

#### 決定事項
型アサーション(as キーワード)を使用して、DIコンテナから取得した値に明示的に型を付与する

#### 影響
- コンパイルエラーを解決
- 型安全性が向上
- コード冗長性が少し増加
- 将来的にはDIコンテナのインターフェース改善が必要

### テンプレート処理の強化

#### コンテキスト
以前の実装ではプレースホルダー置換が不完全で、空セクションや重複フッターの問題があった

#### 決定事項
プレースホルダー置換とクリーンアップのロジックを強化し、空セクションを適切に処理する機能を追加

#### 影響
- 生成されるPRの体裁が改善
- 余分なマークダウンやコメントの問題が解消
- 最終的なPRドキュメントが読みやすくなる

### セクション抽出ロジックの改善

#### コンテキスト
以前のセクション抽出アルゴリズムは不完全で、セクションが正確に抽出されなかった

#### 決定事項
より堅牢なセクション抽出ロジックを実装し、空行の処理や境界条件の処理を改善

#### 影響
- PRの内容が質的に向上
- ユーザーがメモリバンクの内容を正確に反映できる
- エッジケースにも対応可能

### クリーンアーキテクチャの適用

#### コンテキスト
PRの自動生成機能を構造化された方法で実装し、将来の拡張性を高める必要がある

#### 決定事項
クリーンアーキテクチャのパターンに従い、レイヤー分けされた設計を採用（インターフェース層、アプリケーション層、ドメイン層）

#### 影響
- コードの責任分離が明確になる
- ユニットテストが容易になる
- 将来の機能拡張や変更が容易になる
- 初期実装コストが高くなる

### PRタイトルと概要の生成方法

#### コンテキスト
ブランチメモリバンクには開発目的やタスク詳細が記録されており、それらをPR作成時に活用したい

#### 決定事項
ブランチのメモリバンクから情報を抽出し、PRタイトルと概要を自動生成する機能を実装する

#### 影響
- PRの作成プロセスが効率化される
- PRの品質と一貫性が向上する

### PR生成プロセスのワークフロー

#### コンテキスト
PR情報の生成と実際のPR作成を効率的に連携させる必要がある

#### 決定事項
- `create_pull_request` MCPツールを使用してpullRequest.mdファイルを生成
- GitHub ActionsワークフローがpullRequest.mdファイルの存在を検知して自動的にPRを作成
- PR作成後、トリガーファイル（pullRequest.md）を自動的に削除して再トリガーを防止

#### 影響
- 宣言的なアプローチによりプロセスが明確に分離される
- 手動でのPR作成作業が不要になり効率化される
- 一貫性のあるPR内容が保証される

### ブランチメモリバンクからの情報抽出

#### コンテキスト
メモリバンクから関連情報を効果的に抽出し、適切なPRコンテンツを生成する必要がある

#### 決定事項
- 各メモリバンクファイル（activeContext.md, progress.md, systemPatterns.md等）から適切なセクションを抽出
- 多言語対応（日本語・英語）のテンプレートを用意
- メタデータ（タイトル、ターゲットブランチ、レビュワー、ラベル）のカスタマイズをサポート

#### 影響
- 柔軟なPR生成プロセスが実現される
- 開発者は最小限の労力でカスタマイズが可能になる
- 情報抽出の精度によりPR品質が大きく左右される

## 関連ファイルとディレクトリ構造

- `.github/workflows/auto-pr.yml` - PR自動作成用のGitHub Actionsワークフロー
- `src/templates/pull-request-template.md` - 日本語PRテンプレート
- `src/templates/pull-request-template-en.md` - 英語PRテンプレート
- `docs/branch-memory-bank/{branch-name}/pullRequest.md` - 生成されるPR情報ファイル

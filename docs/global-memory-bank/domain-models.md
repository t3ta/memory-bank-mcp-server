# ドメインモデル

tags: #domain #models #architecture #json #document-model

## コアモデル

### MemoryDocument

メモリバンクの中核となるドキュメントモデル。プロジェクトの知識を構造化されたドキュメントとして表現する。

#### 主要属性
- **path**: ドキュメントのパス (DocumentPath)
- **content**: ドキュメントの内容
- **tags**: ドキュメントに関連するタグのリスト
- **lastModified**: 最終更新日時

#### 保存形式
ドキュメントは以下の2つの形式で保存可能：

1. **Markdown形式** (.md)
   - 人間が読み書きしやすいテキスト形式
   - タグはFrontmatter形式でドキュメント先頭に記述

2. **JSON形式** (.json) - v1.1.0以降
   - 構造化データとして保存
   - メタデータとコンテンツを明示的に分離
   - 基本構造:
   ```json
   {
     "schema": "memory_document_v1",
     "metadata": {
       "title": "ドキュメントタイトル",
       "documentType": "ドキュメントタイプ",
       "path": "パス/ファイル名",
       "tags": ["タグ1", "タグ2"],
       "lastModified": "2023-01-01T00:00:00.000Z"
     },
     "content": {
       // ドキュメントタイプ固有のコンテンツ
     }
   }
   ```

### DocumentPath

ドキュメントの場所を表す値オブジェクト。

#### 主要属性
- **value**: 正規化されたパス文字列
- **directory**: パスのディレクトリ部分
- **filename**: パスのファイル名部分
- **extension**: ファイルの拡張子

#### 拡張子による機能
- **isMarkdown()**: .md拡張子を持つドキュメントかどうか
- **isJSON()**: .json拡張子を持つドキュメントかどうか

### Tag

ドキュメントの分類や関連付けに使用されるタグ。

#### 主要属性
- **value**: タグの値
- **isHashtag**: ハッシュタグ形式かどうか

## 関連性

- **MemoryDocument** ↔ **DocumentPath**: 1対1の関係。各ドキュメントは一意のパスを持つ
- **MemoryDocument** ↔ **Tag**: 1対多の関係。各ドキュメントは複数のタグを持つことができる

## 技術的決定事項

### JSONベースのドキュメント形式の導入 (2025-03-16)

#### コンテキスト
これまでのメモリバンクはMarkdown形式でドキュメントを管理していたが、構造化データの管理や検索、フィルタリングが難しい課題があった。将来的なデータベース移行への道筋も考慮する必要があった。

#### 決定事項
JSON形式をプライマリな保存形式として採用し、Markdownをプレゼンテーション用として位置づけることにした。実装方針として：

1. 最初はシンプルなJSON直読み方式から始める
2. ドキュメントはメタデータとコンテンツを明示的に分離
3. 各ドキュメントタイプごとに専用のコンテンツスキーマを定義
4. Markdownとの関係は一方向（JSONからMarkdownを生成）とする
5. 将来的なSurrealDB埋め込み版への移行を見据えた設計とする

#### 影響
- **ポジティブ**
  - 構造化データとしての操作が容易になる
  - タイプセーフなスキーマによる堅牢性向上
  - 検索・フィルタリング機能の拡張が容易になる
  - 将来的なデータベース移行への道筋ができる

- **ネガティブ**
  - 実装の複雑性が増加する
  - JSONファイルの直接編集は人間にとって難しい
  - マイグレーション作業が必要

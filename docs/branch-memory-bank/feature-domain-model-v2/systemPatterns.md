# システムパターン

tags: #domain-model #v2 #json #implementation

## 関連するファイルとディレクトリ構造

```
src/
  domain/
    entities/
      DocumentId.ts           # 新規作成: ドキュメントID値オブジェクト
      JsonDocument.ts         # 新規作成: JSONドキュメントエンティティ
      DocumentPath.ts         # 更新: 互換性維持しつつ機能拡張
      __tests__/
        DocumentId.test.ts    # 新規作成: テスト
        JsonDocument.test.ts  # 新規作成: テスト
        DocumentPath.test.ts  # 更新: 新機能のテスト追加
```

## 主要な技術的判断

### DocumentIdの導入

**コンテキスト**:
以前のメモリバンクでは、ドキュメントの一意性はパス（ファイルパス）のみによって保証されていました。しかし、これではドキュメントが移動した場合に参照整合性が失われたり、リネームの際に問題が生じる可能性がありました。

**決定事項**:
UUIDベースのDocumentId値オブジェクトを導入して、パスとは独立した永続的な識別子を持つようにします。

**結果**:
- 将来的なドキュメント参照や関係性の実装が容易になります
- リネームや移動があっても一貫した識別が可能になります
- データベースへの移行がスムーズになります

### JSONドキュメントのエンティティ化

**コンテキスト**:
既存のMemoryDocumentはMarkdownベースのテキストファイルを中心に設計されており、JSONデータの取り扱いには最適化されていませんでした。

**決定事項**:
専用のJsonDocumentエンティティを作成し、タイプセーフなJSONデータ構造を扱えるようにします。

**結果**:
- 型安全性の向上（TypeScriptの型システムを最大限活用）
- ドキュメントタイプごとの固有ロジックを分離可能
- 柔軟なデータ構造を保ちつつ、堅牢なバリデーションを実現

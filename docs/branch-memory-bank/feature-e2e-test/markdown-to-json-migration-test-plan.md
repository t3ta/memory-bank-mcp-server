# Markdown→JSON移行のテスト計画

## 背景

Memory Bank MCPのドキュメント形式を段階的に変更する計画がある：
1. Markdown (.md) → 現在からの移行対象
2. JSON (.json) → 次の形式、現在移行中
3. YAML (.yaml) → 将来的な目標形式

現在はMarkdownからJSONへの移行フェーズであり、**Markdownへの書き込みを段階的に制限**する必要がある。

## テスト戦略

統合テストとして以下の5つの柱を中心に実装する：

### 1. マイグレーション関連のテスト
- Markdown → JSON変換の検証
- 既存データの変換確認
- 変換後の整合性チェック

### 2. Markdown書き込み禁止テスト
- Markdownへの書き込み要求がエラーになることを確認
- 適切なエラーメッセージが返されるか確認
- JSONパスへのリダイレクトか代替提案が行われるか

### 3. JSON操作の完全性テスト
- すべての以前Markdownで行っていた操作がJSONで可能か
- タグ、メタデータの保存と読み込み
- 検索・フィルタリング機能

### 4. 後方互換性テスト
- 読み取り専用としてのMarkdownサポート継続確認
- 古いクライアントの動作検証

### 5. エラーハンドリングテスト
- 移行期特有のエラーパターン対応
- フォーマット混在時の挙動

## 追加テストケース
- パスマッピングテスト（`.md`パスで要求→`.json`にマッピング）
- 部分更新の挙動（Markdownだと全置換が基本だけど、JSONだと部分更新も使える）
- エスケープシーケンス処理（Markdown特有のエスケープとJSON特有のエスケープの違い）

## 実装方針

1. 既存の統合テスト（controllers/）をベースに拡張
2. 特にMarkdown書き込み禁止に関するテストを重点的に実装
3. 各テストは独立した環境で実行されるよう設計
4. テスト間のリソース競合を避けるため、一意のテストIDを使用

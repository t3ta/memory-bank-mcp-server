# 統合テスト（Integration Test）実装計画

## 現状理解

現在のプロジェクトでは以下の状況が見られます：

1. **E2Eテスト**
   - E2Eテストはプロセス間通信を伴うため実行が不安定
   - サーバー起動・停止のオーバーヘッドが大きい
   - モックサーバーを使用しているため実コードのテストが不十分

2. **既存の統合テスト**
   - 現在2つの基本的なコントローラーテスト（BranchController, GlobalController）が実装済み
   - 基本的なファイル操作（読み書き）のテストは実装されている
   - モックを使わず実際のクラスとコンポーネントを使用している

3. **テスト環境**
   - テスト用の一時ディレクトリ作成と後処理のメカニズムがある
   - 設定ファイル（jest.config.ts）が整っている

## 実装すべき統合テスト

現在の統合テストを拡充するため、以下のテストケースを追加実装します：

### 1. JSONドキュメント操作テスト

- **JSONドキュメントコントローラーテスト**
  - JSONドキュメントの作成と読み取り
  - JSONドキュメントの更新
  - JSONドキュメントの削除
  - JSONドキュメントの検索

### 2. コアファイル操作テスト

- **CoreFilesコントローラーテスト**
  - ブランチのコアファイル読み取り
  - コアファイルの一括更新

### 3. タグ操作テスト

- **Tagsコントローラーテスト**
  - タグによるドキュメント検索
  - タグインデックスの更新

### 4. グローバルコンテキストテスト

- **ReadContextコントローラーテスト**
  - 全コンテキスト読み取り（ルール、ブランチメモリー、グローバルメモリー）
  - 部分的なコンテキスト読み取り

### 5. ブランチ情報テスト

- **RecentBranchesコントローラーテスト**
  - 最近のブランチリスト取得

### 6. エラー処理テスト

- 存在しないブランチアクセス
- 存在しないドキュメントアクセス
- 無効なパス指定
- 無効なデータ形式

## 実装アプローチ

各テストは以下の共通パターンに従って実装します：

1. **テスト環境のセットアップ**
   - 一意のテストID生成
   - テスト用ディレクトリ作成
   - 必要なコンポーネントの初期化

2. **テストケースの実行**
   - 対象機能の呼び出し
   - ファイルシステムへの直接アクセスで結果検証
   - エラーケースのテスト

3. **テスト環境のクリーンアップ**
   - 生成したファイルとディレクトリの削除

## テスト実装順序

1. JSONドキュメント操作テスト
2. コアファイル操作テスト
3. タグ操作テスト
4. グローバルコンテキストテスト
5. ブランチ情報テスト
6. エラー処理テスト

## 注意点

- 各テストは独立して実行可能にする
- テスト間のリソース競合を避けるため、一意のテストIDを使用
- ファイルシステム操作は非同期処理に注意
- エラー処理を適切に実装し、テスト失敗時のデバッグを容易にする

## 開発期間

- 全テスト実装：2-3日
- テスト実行と調整：1-2日

## 期待される効果

1. **テスト品質の向上**
   - 実際のコードパスをテストすることによる信頼性向上
   - モックに依存しないテストによる実装との乖離防止

2. **開発効率の向上**
   - テスト実行時間の短縮
   - テスト実行の安定性向上
   - デバッグの容易化

3. **コード品質の向上**
   - エッジケースの発見と対応
   - インターフェースの一貫性確保

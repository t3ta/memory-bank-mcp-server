# アクティブコンテキスト

## 現在の作業内容

インフラストラクチャ層のファイルシステム抽象化とコンフィグレーションプロバイダの実装を行いました。次はこれらのインフラストラクチャコンポーネントを使用して、リポジトリの実装を進めます。

## 最近の変更点

- インフラストラクチャ層のファイルシステム抽象化を実装
  - IFileSystemService インターフェースの設計
  - FileSystemService の実装（ファイルの読み書き、ディレクトリ操作など）
- コンフィグレーション管理の実装
  - IConfigProvider インターフェースの設計
  - ConfigProvider の実装（設定の読み込み・保存、パス解決など）
- 各インフラストラクチャコンポーネントでのエラーハンドリングの強化

## アクティブな決定事項

- ファイルシステム操作を抽象化し、テスト容易性を向上
- 設定管理を一元化し、環境変数やコマンドライン引数などからの設定読み込みを統一
- エラーハンドリングを各レイヤーで適切に実装
- インフラストラクチャ層でのエラーは InfrastructureError として一元管理
- 各コンポーネントのインターフェースを明確に定義し、実装の詳細を隠蔽

## 検討事項

- リポジトリ実装のアプローチ
  - メモリドキュメントの永続化と復元方法
  - ファイルシステムからのエンティティマッピング
  - タグインデックスの実装方法
- 依存性注入のアプローチ
  - 実装の複雑さとのバランス
  - テスト時のモック置き換え方法
- 既存コードからの段階的な移行方法
  - 既存の機能を維持しながらのリファクタリング
  - 互換性のあるインターフェースの提供

## 次のステップ

1. リポジトリ実装の開発
   - FileSystemMemoryDocumentRepository の実装
   - FileSystemGlobalMemoryBankRepository の実装
   - FileSystemBranchMemoryBankRepository の実装
2. インターフェース層（コントローラーとプレゼンター）の設計と実装
3. 依存性注入の仕組みの実装
4. 既存コードとの統合
5. テストの追加
